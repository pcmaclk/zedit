# 文本编辑器 MVP 工程方案（Rust + egui + Ropey）

> 本文档定义一个 **可运行、可扩展、可演进** 的最小原型（MVP），  
> 作为完整编辑器工程的起点。

---

## 一、MVP 的明确目标（非常重要）

### 1.1 本阶段要做到

- ✅ 打开文本文件
- ✅ 显示文本（支持滚动）
- ✅ 支持中小文件（Ropey）
- ✅ 基础光标移动
- ✅ 单窗口、单文档

### 1.2 本阶段明确不做

- ❌ 语法高亮
- ❌ Undo / Redo
- ❌ 多标签页
- ❌ 搜索 / 替换
- ❌ 配置系统

> **原则：先跑起来，再加功能**

---

## 二、工程目录结构（MVP 版）

editor/
├── Cargo.toml
└── src/
├── main.rs
├── app.rs
├── editor/
│ ├── mod.rs
│ ├── editor.rs
│ └── view.rs
├── document/
│ ├── mod.rs
│ ├── document.rs
│ └── buffer.rs
└── util/
└── file.rs

yaml
复制代码

---

## 三、模块职责划分（极重要）

### 3.1 main.rs

- 启动 egui
- 创建 App
- 不写业务逻辑

---

### 3.2 app.rs（应用根）

职责：

- 持有 Editor
- 处理菜单 / 文件打开
- 管理窗口状态

```rust
pub struct App {
    editor: Editor,
}
3.3 editor 模块
editor.rs
光标状态

当前 Document

键盘输入处理

rust
复制代码
pub struct Editor {
    document: Document,
    cursor_line: usize,
    cursor_col: usize,
}
view.rs
只负责渲染

不修改数据

egui 相关逻辑集中于此

3.4 document 模块
document.rs
rust
复制代码
pub struct Document {
    buffer: Buffer,
}
职责：

文档级抽象

不关心 UI

不关心 egui

buffer.rs（MVP 简化版）
rust
复制代码
pub struct Buffer {
    rope: ropey::Rope,
}
MVP 阶段暂不区分 Large / Medium

3.5 util/file.rs
文件加载

UTF-8 校验

返回 Rope

四、最小运行流程（调用链）
text
复制代码
main
 → App::new
   → Editor::new
     → Document::open
       → Buffer::load
五、核心代码骨架（示意）
5.1 main.rs
rust
复制代码
fn main() {
    eframe::run_native(
        "Text Editor MVP",
        eframe::NativeOptions::default(),
        Box::new(|_| Box::new(App::new())),
    );
}
5.2 app.rs
rust
复制代码
impl eframe::App for App {
    fn update(&mut self, ctx: &egui::Context, _: &mut eframe::Frame) {
        self.editor.ui(ctx);
    }
}
5.3 editor/editor.rs
rust
复制代码
impl Editor {
    pub fn ui(&mut self, ctx: &egui::Context) {
        egui::CentralPanel::default().show(ctx, |ui| {
            self.view(ui);
        });
    }
}
5.4 editor/view.rs（最重要）
rust
复制代码
pub fn view(&self, ui: &mut egui::Ui) {
    egui::ScrollArea::vertical().show(ui, |ui| {
        for i in 0..self.document.line_count() {
            ui.label(self.document.line(i));
        }
    });
}
这是 MVP 能跑起来的关键

5.5 buffer.rs
rust
复制代码
impl Buffer {
    pub fn line(&self, index: usize) -> &str {
        self.rope.line(index).as_str().unwrap_or("")
    }
}
六、MVP 验收标准（必须满足）
 能打开 10MB 文本

 滚动无明显卡顿

 CPU 占用稳定

 没有 unwrap panic

 架构清晰

七、从 MVP 到完整编辑器的演进路径
第一阶段（MVP 完成）
当前文档

第二阶段（性能）
虚拟行

可见区渲染

Rope 优化

第三阶段（功能）
Syntect 高亮

Undo / Redo

多标签页

第四阶段（工程化）
配置

插件

跨平台打包

八、MVP 阶段禁止事项（非常重要）
❌ 提前加 Syntect

❌ 提前抽象插件

❌ 提前多文档

❌ 复杂泛型

❌ 过度 trait 化

九、你现在可以立刻做的事
cargo new editor

按目录拆文件

先把 ScrollArea + Rope 显示 跑起来

提交一次干净的 commit