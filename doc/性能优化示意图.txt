性能优化示意图，专门针对大文件编辑和渲染流程，标注 虚拟渲染、增量高亮、分块 I/O、可见行计算，方便开发时优化性能


            ┌──────────────────────────────┐
            │          文件 I/O 层          │
            │ - 分块读取 / memmap           │
            │ - UTF-8 / UTF-16 编码处理     │
            └───────────┬──────────────────┘
                        │ 文件块数据
                        ▼
            ┌──────────────────────────────┐
            │      文本缓冲区 (Ropey)       │
            │ - 插入 / 删除 / 切片 O(log n)│
            │ - Undo/Redo 栈               │
            │ - 管理文本行索引             │
            └───────────┬──────────────────┘
                        │ 可见行索引 / 更新区
                        ▼
            ┌──────────────────────────────┐
            │    虚拟渲染 & 可见行选择       │
            │ - 只渲染屏幕可见行            │
            │ - 滚动时更新 visible_range      │
            └───────────┬──────────────────┘
                        │ 可见行数据
                        ▼
            ┌──────────────────────────────┐
            │       语法高亮层 (Syntect)    │
            │ - 对可见行增量高亮            │
            │ - 高亮结果缓存                 │
            │ - 主题应用                     │
            └───────────┬──────────────────┘
                        │ 高亮颜色信息
                        ▼
            ┌──────────────────────────────┐
            │         GUI 渲染层            │
            │ - draw_text_with_colors()      │
            │ - 光标位置更新                 │
            │ - 滚动位置更新                 │
            └───────────┬──────────────────┘
                        │ 用户可见
                        ▼
            ┌──────────────────────────────┐
            │      搜索/替换 & 插件层       │
            │ - 搜索仅在可见行或范围内进行  │
            │ - 插件可操作文本缓冲或 GUI    │
            └──────────────────────────────┘

优化关键点

分块 I/O

打开 GB 级文件时，不一次性读取

只加载当前缓冲可见区域及前后缓冲块

Ropey 文本缓冲

插入/删除 O(log n)，支持大文件编辑

结合 Undo/Redo 栈管理操作

虚拟渲染

只渲染屏幕可见行，避免整文件重绘

滚动时动态计算 visible_range

增量高亮 (Syntect)

只对更新的行或可见行重新高亮

高亮结果缓存，避免重复计算

搜索/替换优化

可限制在可见行或特定范围

对大文件只处理必要文本，提升性能

插件优化

插件调用通过 API 操作文本/GUI/文件，避免全局刷新

可异步执行，减少阻塞渲染

💡 效果

打开/编辑 GB 级文本仍然流畅

滚动不卡顿，高亮即时更新

插件、搜索/替换可同时响应，无阻塞主渲染循环