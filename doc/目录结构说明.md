# 目录结构说明

## 当前项目结构

```
REditor/
├── Cargo.toml                    # 项目依赖配置
├── Cargo.lock                    # 依赖锁定文件
├── .gitignore                    # Git忽略配置
├── resources/                    # 资源文件目录
│   └── (字体文件存放位置)
├── doc/                          # 文档目录
│   ├── 高层次用户操作流程图.txt
│   ├── 模块交互图.txt
│   ├── 模块详细设计文档.txt
│   ├── 完整的技术架构 + 用户操作 + 数据流整合图.txt
│   ├── 文本编辑器 MVP 工程方案（Rust + egui + Ropey）.txt
│   ├── 文本渲染与虚拟行布局设计（egui）.txt
│   ├── 性能设计与边界说明.txt
│   ├── 性能优化示意图.txt
│   ├── 最终整合图.txt
│   ├── Buffer 与大文件处理设计文档.txt
│   ├── Editor-Document状态机与命令系统设计文档.txt
│   ├── Rust开发方案.txt
│   ├── Syntect增量高亮工程实现文档.txt
│   ├── 国际化(i18n)模块详细设计文档.md    # 新增
│   └── 开发计划更新.md                    # 新增
└── src/                          # 源代码目录
    ├── main.rs                   # 程序入口 + 字体配置
    ├── app/                      # 应用层
    │   ├── mod.rs
    │   └── app.rs               # App状态管理
    ├── editor/                   # 编辑器核心
    │   ├── mod.rs
    │   └── editor.rs            # 编辑器协调器
    ├── document/                 # 文档管理
    │   ├── mod.rs
    │   ├── document.rs          # 文档管理
    │   └── buffer.rs            # Ropey缓冲区封装
    ├── gui/                      # UI层
    │   ├── mod.rs
    │   ├── main_window.rs       # 主窗口UI
    │   └── editor_view.rs       # 编辑区渲染
    ├── io/                       # I/O操作
    │   ├── mod.rs
    │   └── file.rs              # 文件操作
    ├── plugin/                   # 插件系统（占位）
    │   └── mod.rs
    └── util/                     # 工具函数（占位）
        └── mod.rs
```

## 模块职责详解

### 1. 程序入口 (main.rs)
**职责**: 
- 启动egui应用
- 配置字体系统（支持中文）
- 创建App实例
- 不包含业务逻辑

**关键代码**:
```rust
fn main() {
    let options = eframe::NativeOptions::default();
    eframe::run_native(
        "REditor",
        options,
        Box::new(|cc| {
            configure_fonts(&cc.egui_ctx);  // 字体配置
            let app = Rc::new(RefCell::new(App::new()));
            let main_window = MainWindow::new(app);
            Box::new(main_window)
        }),
    )
    .expect("failed to start eframe");
}
```

### 2. 应用层 (app/)
**核心文件**: `app.rs`

**职责**:
- 全局状态管理
- 持有Editor实例
- 协调各模块

**结构**:
```rust
pub struct App {
    pub editor: Editor,  // 编辑器实例
}

impl App {
    pub fn new() -> Self {
        Self {
            editor: Editor::new(),
        }
    }
}
```

### 3. 编辑器核心 (editor/)
**核心文件**: `editor.rs`

**职责**:
- 光标状态管理（行、列）
- 键盘输入处理
- 协调Document和UI
- 未来将处理Undo/Redo

**当前状态**:
```rust
pub struct Editor {
    pub document: Document,  // 当前文档
    // 待添加: cursor_line, cursor_col, history等
}

impl Editor {
    pub fn new() -> Self {
        Self {
            document: Document::new(),
        }
    }
}
```

### 4. 文档管理 (document/)
**核心文件**: `document.rs`, `buffer.rs`

**职责**:
- `document.rs`: 文档级抽象，管理文档状态
- `buffer.rs`: Ropey封装，文本操作

**结构**:
```rust
// document.rs
pub struct Document {
    buffer: Buffer,
    // 待添加: 文件路径、编码、修改状态等
}

// buffer.rs
pub struct Buffer {
    rope: ropey::Rope,
}
```

### 5. UI层 (gui/)
**核心文件**: `main_window.rs`, `editor_view.rs`

**职责**:
- `main_window.rs`: 整体UI布局（菜单、工具栏、状态栏）
- `editor_view.rs`: 编辑区渲染

**UI布局**:
```
┌─────────────────────────────┐
│ 菜单栏 (文件 编辑 视图)      │
├─────────────────────────────┤
│ 工具栏 (打开 保存 撤销...)   │
├─────────────────────────────┤
│ 标签页 ([未命名] +)          │
├─────────────────────────────┤
│                             │
│  编辑区 (editor_view)       │
│                             │
├─────────────────────────────┤
│ 状态栏 (行:1 列:1 UTF-8...) │
└─────────────────────────────┘
```

### 6. I/O操作 (io/)
**核心文件**: `file.rs`

**职责**:
- 文件选择对话框
- 文件读取/写入
- UTF-8编码验证
- 错误处理

**待实现**:
```rust
pub fn open_file() -> Result<Document, String> {
    // 1. 打开文件对话框
    // 2. 读取文件内容
    // 3. 创建Document
    // 4. 错误处理
}

pub fn save_file(document: &Document, path: &str) -> Result<(), String> {
    // 1. 保存文件
    // 2. 错误处理
}
```

### 7. 插件系统 (plugin/)
**核心文件**: `mod.rs`

**职责**:
- 未来插件架构占位
- 目前为空，为扩展预留

### 8. 工具函数 (util/)
**核心文件**: `mod.rs`

**职责**:
- 通用工具函数
- 目前为空，按需添加

## 未来扩展目录

### 国际化 (i18n/)
**计划添加**: `src/i18n/`

```
src/i18n/
├── mod.rs              # 模块入口
├── manager.rs          # 翻译管理器
├── languages.rs        # 语言定义
├── translations.rs     # 翻译数据
└── constants.rs        # 翻译键定义
```

**参考**: `doc/国际化(i18n)模块详细设计文档.md`

### 配置系统 (config/)
**计划添加**: `src/config/`

```
src/config/
├── mod.rs
├── settings.rs         # 设置管理
└── storage.rs          # 持久化存储
```

## 文件命名规范

### Rust标准
- **文件名**: `snake_case` (小写+下划线)
- **结构体名**: `PascalCase` (大驼峰)
- **函数名**: `snake_case` (小写+下划线)
- **变量名**: `snake_case` (小写+下划线)

### 一致性检查
✅ `main_window.rs` - 正确  
✅ `editor_view.rs` - 正确  
✅ `editor.rs` - 正确  
✅ `document.rs` - 正确  
✅ `buffer.rs` - 正确  

## 模块导入关系

```rust
// main.rs
mod app;
mod document;
mod editor;
mod gui;
mod io;
mod plugin;
// mod i18n;  // 未来添加

// app.rs
use crate::editor::Editor;

// editor.rs
use crate::document::Document;

// document.rs
use crate::document::buffer::Buffer;

// main_window.rs
use crate::app::App;
use crate::gui::editor_view;

// editor_view.rs
use crate::document::Document;

// io/file.rs
use crate::document::Document;
```

## 依赖关系图

```
main.rs
  ↓
app.rs (持有Editor)
  ↓
editor.rs (持有Document, 处理光标和输入)
  ↓
document.rs (持有Buffer, 文档抽象)
  ↓
buffer.rs (Ropey封装, 文本操作)
  ↓
io/file.rs (文件读写)
```

## 扩展性设计

### 易于添加的功能
1. **新模块**: 在src下创建新目录，添加mod.rs
2. **新UI组件**: 在gui/下添加新文件
3. **新功能**: 在editor/或document/中扩展
4. **新语言**: 在i18n/中添加翻译

### 架构优势
- ✅ **职责清晰**: 每层只做自己的事
- ✅ **低耦合**: 模块间依赖明确
- ✅ **易测试**: 可以独立测试各层
- ✅ **易扩展**: 添加新功能不影响现有代码

## 下一步开发建议

### 立即开始
1. **添加文件对话框依赖**
   ```toml
   [dependencies]
   rfd = "0.14"
   ```

2. **实现文件打开功能**
   - 在 `io/file.rs` 中添加 `open_file_dialog()`
   - 在 `main_window.rs` 中连接"打开"按钮
   - 测试文件加载和显示

3. **添加光标系统**
   - 在 `Editor` 中添加 `cursor_line` 和 `cursor_col`
   - 处理键盘输入
   - 实现光标移动

### 避免的陷阱
- ❌ 不要在main.rs中写业务逻辑
- ❌ 不要在UI层直接操作Rope
- ❌ 不要过早优化（先让功能跑起来）
- ❌ 不要跳过错误处理

---

**文档版本**: v1.0  
**创建日期**: 2025-12-30  
**状态**: 当前结构已确定，待功能扩展